# 员工使用指南

<span id="首次使用获得连接信息并登录"></span>
## 首次使用：获得连接信息并登录

**前提**：管理员已为你创建账号，并**将 MQTT 连接信息（mqtt_connection）交付给你**。其中通常包含：

- Broker 地址（broker_host）、端口（broker_port）、是否 TLS（use_tls）；
- 连接凭证：client_id 规则，或 mqtt_username / mqtt_password（或 token）。

**步骤**：

1. 打开 MoltChat 客户端（Web / 桌面 / 移动端）。
2. 在「登录」或「配置」页中，填入上述 **MQTT 连接信息**（若客户端支持，可能以「扫码」或「链接」形式一键填入）。
3. 确认连接；客户端会使用该信息连接 MQTT Broker，并完成会话绑定（如 auth.bind）。
4. 登录成功后，你会看到自己的收件箱、已加入的群列表（若有）、以及组织架构/通讯录（依客户端实现）。

**多端登录**：你可以在手机和电脑上同时登录；每个设备会独立收消息，历史记录由各端本地保存（系统不提供云端历史拉取）。

## 收发单聊消息

- **发消息**：在会话中选择一位同事（或 AI Agent），输入内容后发送。客户端会通过 `msg.send_private` 将消息发往对方 employee_id；对方在其收件箱中会收到该条消息。
- **收消息**：你收到的单聊与系统通知都会出现在**收件箱**中；客户端会按本地逻辑展示会话列表与历史（历史由客户端本地存储）。

支持文本、图片、文件等类型；图片/文件会先上传到对象存储（见 [获取对象存储配置并上传/下载文件](#获取对象存储配置并上传下载文件)），消息中只带链接或元数据。

## 收发群聊消息

- **查看已加入的群**：通过组织架构或「群列表」进入某个群（group_id）。
- **发群消息**：在群内输入内容并发送；客户端会通过 `msg.send_group` 发送到该 group_id，群内所有成员都会收到。
- **收群消息**：只要你在该群成员列表中，该群的新消息会推送到你的客户端；同样，群内历史由客户端本地保存与展示。

可在群内 @ 指定成员（人类或 AI Agent），或输入关键词触发 AI Agent（见 [与 AI Agent 协作](#与-ai-agent-协作)）。

<span id="与-ai-agent-协作"></span>
## 与 AI Agent 协作

- **查看可用 Agent**：在客户端中可查看「可调用能力」或 Agent 列表（对应 `agent.capability_list`），了解有哪些数字员工及其能力（如「订单查询」「产品推荐」）。
- **单聊中与 Agent 对话**：在单聊中选择某个 AI Agent 为会话对象，直接发送问题或指令；服务端会将消息转发给该 Agent 的 webhook，Agent 回复后会投递回你的收件箱。
- **群聊中 @ Agent**：在群内 @ 某 AI Agent（如 @报销机器人），或发送其配置的**触发关键词**（如「查订单」），服务端会识别并路由到对应 Agent；回复会发到群内，全员可见。
- **转人工**：若 Agent 无法解决或超时，可发送「转人工」或按客户端提示操作，会话可转交指定人类员工继续处理。

<span id="获取对象存储配置并上传下载文件"></span>
## 获取对象存储配置并上传/下载文件

**目的**：在发图片、发文件或查看他人发的文件时，需要能够**上传到对象存储**或**从对象存储下载**。系统通过「对象存储读写配置」让你在客户端直接读写，无需经服务端中转文件内容。

**步骤**：

1. 确保已**登录 MQTT**（见 [首次使用](#首次使用获得连接信息并登录)）。
2. 在客户端中触发「获取存储配置」或「刷新存储配置」（对应 `config.storage` 请求）。客户端会向服务端请求当前账号的对象存储读写配置。
3. 服务端校验身份后，返回配置（如 endpoint、bucket、区域、临时凭证或预签名策略及过期时间）。
4. 客户端使用该配置初始化 S3 兼容 SDK 或直接发起上传/下载：
   - **上传**：你选择图片或文件后，客户端按配置直传对象存储，得到 URL 或 key，再通过 `msg.send_private` / `msg.send_group` 把该链接或元数据发给对方或群。
   - **下载**：收到带文件/图片链接的消息时，客户端按配置从对象存储直接下载并展示。

**说明**：配置通常有时效（如 expires_at）；过期后需再次请求 `config.storage` 获取新配置。部分实现也可能提供「按次临时 URL」（如 `file.upload_url` / `file.download_url`），用于单次上传或下载，可依客户端设计二选一或并存。

## 查看组织架构与同事状态

- **组织架构**：在「通讯录」或「组织」页可查看部门树和员工列表（含人类与 AI Agent），数据来自 `org.tree`。
- **在线状态**：若客户端展示在线/离线，则来自各员工的 `mchat/status/{employee_id}` 状态（LWT）；你上线后会发布自己的在线状态，断线后系统会标记为离线。

## 员工操作小结

| 操作             | 说明 |
|------------------|------|
| 首次登录         | 使用管理员下发的 **mqtt_connection** 在客户端配置并连接 |
| 单聊             | 选择对象后发送消息；收件箱收单聊与系统通知，历史本地保存 |
| 群聊             | 在已加入的群中发送/接收消息；可 @ 成员或发关键词触发 Agent |
| 与 AI 协作       | 单聊选 Agent 或群内 @/关键词；必要时「转人工」 |
| 文件/图片        | 先通过 **config.storage** 获取对象存储配置，再直传/直下；消息中只带链接或元数据 |
| 组织与状态       | org.tree 看架构；状态来自 status 主题 |
