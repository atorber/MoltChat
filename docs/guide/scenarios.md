# 典型场景

## 新员工入职：从注册到首次登录

1. **管理员**：在管理端执行「注册员工」，填写新员工姓名、部门等，不勾选 AI Agent。提交后获得响应，其中包含该员工的 **mqtt_connection**。
2. **管理员**：将 mqtt_connection（或客户端登录链接/二维码）通过公司安全渠道发给新员工。
3. **新员工**：打开 MChat 客户端，填入或扫描下发的连接信息，完成 MQTT 连接与登录。
4. **新员工**：在客户端中请求「获取对象存储配置」（config.storage），之后即可在单聊/群聊中发送图片与文件。
5. **新员工**：在通讯录或组织架构中看到同事与群组，可发起单聊或进入已有群参与讨论。

## 创建项目群并邀请成员与 AI Agent

1. **管理员**：执行「创建群组」，输入群名（如「XX 项目组」）和初始成员 employee_id 列表（可包含人类员工和已注册的 AI Agent）。
2. 系统创建群组并向每位成员收件箱推送入群通知。
3. **成员**：在客户端看到新群，进入后即可收发群消息。
4. **成员**：在群内 @ 某 AI Agent（如「@销售小助 查一下订单状态」），Agent 回复会出现在群内，便于项目组共享信息。

## 员工向 AI Agent 查订单并转人工

1. **员工**：在单聊中选择「销售 AI」或群内 @ 销售 Agent，发送「查订单 12345」。
2. 服务端识别关键词或 @，将消息转发至该 Agent 的 webhook；Agent 查询后回复订单状态，消息投递回单聊或群。
3. 若 Agent 超时或回复「需要人工处理」，**员工**发送「转人工」或点击客户端「转人工」；会话可转交指定人类客服，由人类继续跟进。

## 员工在群内发送图片/文件

1. **员工**：已登录且曾获取过对象存储配置（或此时请求一次 config.storage）。
2. 在群聊中选择「发送图片」或「发送文件」，客户端使用当前存储配置**直接上传**到对象存储，得到 URL。
3. 客户端通过 `msg.send_group` 发送一条消息，content 为图片/文件类型，body 中含 url、name、size 等。
4. **其他成员**：收到该条群消息后，客户端根据 content 中的 url 与自身存储配置**直接下载**并展示图片或提供文件下载。

## 管理员维护组织架构与 Agent 能力

1. **管理员**：通过「部门管理」（见 [系统管理员指南 - 部门管理](admin.md#部门管理)）创建或调整部门（若支持 department.create/update），通过 `org.tree` 查看部门树与员工列表，通过 employee.update 调整员工的部门（department_id）或汇报关系（manager_id）。
2. **管理员**：为某 AI Agent 更新能力或关键词（employee.update，更新 agent_profile），保存后该 Agent 的「可调用能力」对员工侧可见的会随之更新。
3. **员工**：在「可调用能力」或 Agent 列表中看到更新后的技能说明，便于正确 @ 或使用关键词触发。
